<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tools and Resources Directory</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Tools and Resources Directory</h1>
    <div id="loadingIndicator">Loading resources...</div>
    <div id="resourceList" class="resource-grid"></div>
    <button id="loadMoreButton" style="display: none;">Load More</button>
    <button id="refreshButton">Refresh Data</button>
    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwNJFg4N6xewWBfCzruMzCcfP1XQvG6i2b10Y7jPT7LAt4wJQ3aY9fPqjrWf4OunexMaQ/exec';
        let cachedResources = null;
        const PAGE_SIZE = 10;
        let currentPage = 1;

        function showLoading(show) {
            document.getElementById('loadingIndicator').style.display = show ? 'block' : 'none';
        }

        async function fetchResources(forceRefresh = false) {
            if (!forceRefresh) {
                const cachedData = localStorage.getItem('resourcesCache');
                const lastUpdated = localStorage.getItem('lastUpdated');
                if (cachedData && lastUpdated) {
                    const parsedData = JSON.parse(cachedData);
                    const cacheAge = Date.now() - parseInt(lastUpdated);
                    if (cacheAge < 3600000) { // Cache is less than 1 hour old
                        cachedResources = parsedData;
                        renderResources(parsedData.slice(0, PAGE_SIZE));
                        return;
                    }
                }
            }

            showLoading(true);
            try {
                const response = await fetch(`${SCRIPT_URL}?action=read`);
                const data = await response.json();
                cachedResources = data;
                localStorage.setItem('resourcesCache', JSON.stringify(data));
                localStorage.setItem('lastUpdated', Date.now().toString());
                renderResources(data.slice(0, PAGE_SIZE));
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to fetch resources. Please try again.');
            } finally {
                showLoading(false);
            }
        }

        function renderResources(data) {
            const resourceList = document.getElementById('resourceList');
            resourceList.innerHTML = ''; // Clear existing resources
            data.forEach(resource => {
                const div = document.createElement('div');
                div.className = 'resource-card';
                div.innerHTML = `
                    <h3>${resource.Name}</h3>
                    <p>${resource.Description}</p>
                    <p>Category: ${resource.Category}</p>
                    <a href="${resource.URL}" target="_blank">Visit</a>
                `;
                resourceList.appendChild(div);
            });
            
            document.getElementById('loadMoreButton').style.display = 
                cachedResources.length > currentPage * PAGE_SIZE ? 'block' : 'none';
        }

        function loadMore() {
            currentPage++;
            const startIndex = (currentPage - 1) * PAGE_SIZE;
            const endIndex = startIndex + PAGE_SIZE;
            renderResources(cachedResources.slice(startIndex, endIndex));
        }

        document.getElementById('loadMoreButton').addEventListener('click', loadMore);
        document.getElementById('refreshButton').addEventListener('click', () => fetchResources(true));

        // Initial fetch
        fetchResources();
    </script>
</body>
</html>